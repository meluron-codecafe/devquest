<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DevQuest</title>
<style>
    :root {
        --bg-color: #121212;
        --text-color: #e0e0e0;
        --container-bg: #1e1e1e;
        --border-color: #555;
        --hover-bg: #2a2a2a;
        --link-color: #4ea3ff;
        --topic-link-color: #aad4ff;
        --table-header-bg: #2b2b2b;
        --quote-color: #bbb;
        --footer-color: #999;
    }
    body.light-theme {
        --bg-color: #f2f2f2;
        --text-color: #333;
        --container-bg: #fff;
        --border-color: #ccc;
        --hover-bg: #fafafa;
        --link-color: #0066cc;
        --topic-link-color: #0066cc;
        --table-header-bg: #f5f5f5;
        --quote-color: #777;
        --footer-color: #777;
    }

    body {
        font-family: "Segoe UI", Tahoma, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        padding: 20px;
        transition: background-color 0.3s, color 0.3s;
    }
    .container {
        max-width: 900px;
        margin: 0 auto;
        background: var(--container-bg);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 20px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        position: relative;
        transition: background 0.3s, border 0.3s;
    }
    .header {
        display: flex;
        justify-content: center; /* center logo */
        align-items: center;
        margin-bottom: 10px;
        position: relative;
    }
    .logo {
        max-width: 80px;
        height: auto;
        display: block;
        margin: 0 auto;
        cursor: pointer;
        position: relative;
        transition: opacity 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateX(-50%) translateY(-5px); }
        to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    /* ======= BUTTON CONTAINER ======= */
    .button-container {
        position: absolute;
        top: -15px;
        right: -15px;
        background: rgba(45, 45, 45, 0.95);
        border: 2px solid var(--border-color);
        border-radius: 12px;
        padding: 2px;
        display: flex;
        z-index: 1000;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
    }
    
    /* ======= THEME TOGGLE BUTTON STYLES ======= */
    .theme-toggle-btn {
        background: transparent;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        transition: all 0.3s ease;
        color: var(--text-color);
        position: relative;
        overflow: hidden;
    }

    /* Theme icon container for smooth transitions */
    .theme-icon {
        position: absolute;
        opacity: 0;
        transform: scale(0.5) rotate(180deg);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
    }

    .theme-icon.active {
        opacity: 1;
        transform: scale(1) rotate(0deg);
    }

    /* SVG icon styling */
    .theme-icon svg {
        width: 20px;
        height: 20px;
        stroke: currentColor;
        fill: none;
        transition: all 0.2s ease;
        color: inherit;
    }

    .github-btn {
        background: transparent !important;
        color: var(--text-color);
        border: none !important;
        border-radius: 0;
        width: 40px;
        height: 40px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        transition: transform 0.3s ease, color 0.3s ease;
        text-decoration: none;
        box-shadow: none !important;
    }

    /* Light theme button styles */
    body.light-theme .button-container {
        background: rgba(255, 255, 255, 0.95);
        border-color: var(--border-color);
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    /* Light mode SVG colors */
    body.light-theme .theme-icon svg {
        stroke: #333333;
        color: #333333;
    }

    /* DevQuest Description */
    .description {
        text-align: center;
        margin: 20px auto 25px auto;
        padding: 6px 0px;
        background: rgba(77, 163, 255, 0.1);
        border: 1px solid rgba(77, 163, 255, 0.3);
        border-radius: 8px;
        color: var(--text-color);
        font-size: 14px;
        line-height: 1.6;
        max-width: 575px;
    }

    .description strong {
        color: var(--link-color);
        font-weight: 600;
    }

    body.light-theme .description {
        background: rgba(77, 163, 255, 0.05);
        border-color: rgba(77, 163, 255, 0.2);
    }

    .controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }
    .right-controls {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    .request-topic-btn {
        background-color: #fd8a09;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        transition: background-color 0.3s;
        white-space: nowrap;
    }
    .request-topic-btn:hover {
        background-color: #e6750a;
    }
    select, input {
        padding: 6px 8px;
        font-size: 14px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background: var(--container-bg);
        color: var(--text-color);
        transition: background 0.3s, color 0.3s;
    }
    #searchBox {
        width: 250px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    th, td {
        border-bottom: 1px solid var(--border-color);
        padding: 8px 10px;
        text-align: left;
        font-size: 14px;
    }
    th {
        background-color: var(--table-header-bg);
        color: var(--text-color);
        position: relative;
    }
    tr:hover {
        background-color: var(--hover-bg);
    }
    a {
        color: var(--link-color);
    }
    a:hover {
        text-decoration: underline;
    }
    
    /* Category info icon styles */
    .category-header {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    .info-icon {
        cursor: pointer;
        font-size: 14px;
        color: var(--link-color);
        opacity: 0.7;
        transition: opacity 0.3s;
    }
    .info-icon:hover {
        opacity: 1;
    }
    
    /* Tooltip styles */
    .info-icon {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        width: 15px;
        height: 15px;
        border-radius: 50%;
        border: 1px solid var(--link-color);
        background: transparent;
        color: var(--link-color);
        font-size: 12px;
        font-weight: bold;
        cursor: pointer;
    }

    .tooltip {
        position: absolute;
        background: var(--container-bg);
        border: 4px solid var(--border-color);
        border-radius: 6px;
        padding: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 1000;
        max-width: 300px;
        font-size: 12px;
        line-height: 1.4;
        display: none;
    }
    .tooltip.visible {
        display: block;
    }
    .tooltip h4 {
        margin: 0 0 8px 0;
        color: var(--link-color);
        font-size: 14px;
    }
    .tooltip p {
        margin: 0 0 8px 0;
    }
    .tooltip p:last-child {
        margin-bottom: 0;
    }

    /* Preview tooltip styles */
    .preview-tooltip {
        position: absolute;
        background: var(--container-bg);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        padding: 16px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        z-index: 1001;
        max-width: 450px;
        font-size: 13px;
        line-height: 1.5;
        display: none;
        backdrop-filter: blur(10px);
        transition: opacity 0.3s ease;
    }
    
    .preview-tooltip.visible {
        display: block;
        animation: fadeInUp 0.3s ease;
    }
    
    @keyframes fadeInUp {
        from { 
            opacity: 0; 
            transform: translateY(10px);
        }
        to { 
            opacity: 1; 
            transform: translateY(0);
        }
    }
    
    .preview-tooltip .preview-title {
        font-weight: bold;
        color: var(--link-color);
        margin-bottom: 12px;
        font-size: 14px;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 6px;
    }
    
    .preview-tooltip .preview-section {
        margin-bottom: 12px;
    }
    
    .preview-tooltip .preview-section:last-child {
        margin-bottom: 0;
    }
    
    .preview-tooltip .section-title {
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 4px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .preview-tooltip .section-content {
        color: var(--quote-color);
        margin-left: 8px;
    }
    
    .preview-tooltip .section-content img {
        max-width: 100%;
        height: auto;
        border-radius: 4px;
        margin: 8px 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .preview-tooltip .preview-html {
        color: var(--text-color);
        margin-left: 0;
    }
    
    .preview-tooltip .preview-html img {
        max-width: 100%;
        height: auto;
        max-height: 200px;
        border-radius: 4px;
        margin: 8px 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        object-fit: contain;
    }
    
    .preview-tooltip .loading {
        text-align: center;
        color: var(--quote-color);
        font-style: italic;
    }
    
    .preview-tooltip .error {
        text-align: center;
        color: #f87171;
        font-style: italic;
    }
    
    .footer {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid var(--border-color);
        color: var(--footer-color);
        font-size: 14px;
    }
    .footer a {
        color: #fd8a09;
        text-decoration: none;
    }
    .footer a:hover {
        text-decoration: underline;
    }
    
    /* Table links (topics) */
    #tutorialTable a {
        color: var(--topic-link-color);
        text-decoration: none;
        font-weight: 500;
    }
    
    #tutorialTable a:hover {
        text-decoration: underline;
        color: #4ea3ff;
    }
    
    @media (max-width: 768px) {
        .controls {
            flex-direction: column;
            align-items: stretch;
        }
        .right-controls {
            justify-content: flex-start;
            margin-top: 10px;
        }
        #searchBox {
            width: 100%;
        }
        .tooltip {
            max-width: 250px;
        }
        .button-container {
            top: 10px;
            right: 10px;
            padding: 6px;
        }
        .theme-toggle-btn {
            width: 40px;
            height: 40px;
            font-size: 18px;
        }
        .github-btn {
            width: 35px;
            height: 35px;
            font-size: 16px;
        }
        .description {
            margin: 15px auto 20px auto;
            padding: 12px 16px;
            font-size: 13px;
        }
    }

    @media (max-width: 480px) {
        .button-container {
            flex-direction: column;
            gap: 6px;
        }
        .theme-toggle-btn {
            width: 36px;
            height: 36px;
            font-size: 16px;
        }
        .github-btn {
            width: 32px;
            height: 32px;
            font-size: 14px;
        }
    }
</style>
</head>
<body>
<div class="container">
    <!-- Header -->
    <div class="header">
        <div style="position: relative;">
            <img src="https://raw.githubusercontent.com/meluron/assets/refs/heads/main/logos/meluron-codecafe/DevQuest/icon.png" class="logo" id="logo">
        </div>
        <div class="button-container">
            <button id="themeToggle" class="theme-toggle-btn" title="Toggle theme">
                <div class="theme-icon dark">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </div>
                <div class="theme-icon light">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </div>
            </button>
            <a href="https://github.com/meluron-codecafe/DevQuest" target="_blank" class="github-btn" title="View on GitHub">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
        </div>
    </div>

    <!-- DevQuest Description -->
    <div class="description">
        DevQuest offers <strong>Python</strong>, <strong>Audio DSP</strong>, and <strong>AI/ML</strong> tutorials through Jupyter notebooks.
    </div>

    <div class="controls">
        <!-- Left -->
        <select id="categoryFilter">
            <option value="">All Categories</option>
        </select>

        <!-- Right -->
        <div class="right-controls">
            <input type="text" id="searchBox" placeholder="Search topics or subtopics...">
            <a href="#" id="requestTopicBtn" class="request-topic-btn">Request Topic</a>
        </div>
    </div>

    <table id="tutorialTable">
        <thead>
            <tr>
                <th>
                    <div class="category-header">
                        Category
                        <span class="info-icon" id="categoryInfo">?</span>
                    </div>
                </th>
                <th>Topic</th>
                <th>Tags</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    
    <!-- Tooltip for category info -->
    <div id="categoryTooltip" class="tooltip"></div>
    
    <!-- Preview tooltip for topics -->
    <div id="previewTooltip" class="preview-tooltip"></div>
    
</div>
    
<div class="footer">
    An initiative by <a href="https://github.com/meluron" target="_blank">meluron</a> to bring context to learning.
</div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    
    <script>
        const categoryColors = [
            "#fd8a09", // orange
            "#4ade80", // green
            "#60a5fa", // light blue
            "#f472b6", // pink
            "#facc15", // yellow
            "#a78bfa", // purple
            "#34d399", // teal
            "#f87171", // red
        ];
        
        let tutorials = [];
        
        // Category descriptions dictionary
        const categoryDescriptions = {
            "EXP": {
                "title": "EXP",
                "description": "Experiments: Conducting experiments, exploring ideas, and uncovering insights on various topics."
            },
            "P2C": {
                "title": "P2C",
                "description": "Paper to Code: Breaking down research papers into practical, working implementations."
            },
            "M4CS": {
                "title": "M4CS",
                "description": "Math for CS: Exploring math concepts that form the backbone of computer science and programming."
            },
            "TOOL": {
                "title": "TOOL",
                "description": "Discovering and experimenting with tools to solve real-world problems efficiently."
            }
        };
        
        // Dynamic category-color map
        const categoryColorMap = {};
        
        function assignCategoryColors() {
            const uniqueCategories = [...new Set(tutorials.map(t => t.category))].sort();
            uniqueCategories.forEach((cat, idx) => {
                categoryColorMap[cat] = categoryColors[idx % categoryColors.length];
            });
        }
        
        // Theme management - only dark and light
        let currentTheme = 'dark'; // Will be set based on system preference
        
        const themeToggle = document.getElementById("themeToggle");
        const themeIcons = {
            dark: document.querySelector(".theme-icon.dark"),
            light: document.querySelector(".theme-icon.light")
        };
        
        // Check for system preference
        function getSystemTheme() {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        
        // Apply theme to DOM
        function applyTheme(theme) {
            // Remove all theme classes
            document.body.classList.remove('light-theme', 'dark-theme');
            
            // Apply the theme class
            if (theme === 'light') {
                document.body.classList.add('light-theme');
            } else {
                document.body.classList.add('dark-theme');
            }
        }
        
        // Update theme toggle UI
        function updateThemeToggle() {
            // Remove active class from all icons
            Object.keys(themeIcons).forEach(function(key) {
                themeIcons[key].classList.remove('active');
            });
            
            // Add active class to current theme icon
            themeIcons[currentTheme].classList.add('active');
            
            // Update tooltip
            var themeNames = {
                dark: 'Theme: Dark',
                light: 'Theme: Light'
            };
            themeToggle.title = themeNames[currentTheme];
        }
        
        // Theme toggle click handler - only toggle between dark and light
        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            applyTheme(currentTheme);
            updateThemeToggle();
            
            // Save preference
            localStorage.setItem('theme-preference', currentTheme);
        }
        
        themeToggle.addEventListener("click", toggleTheme);
        
        // Initialize theme - always start with system preference on page load
        currentTheme = getSystemTheme();
        applyTheme(currentTheme);
        updateThemeToggle();
        
        // Real-time system theme change detection - updates without page reload
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            // Automatically detect and apply system theme changes
            currentTheme = getSystemTheme();
            applyTheme(currentTheme);
            updateThemeToggle();
            
            // Optional: Clear any saved manual preference since we're following system
            localStorage.removeItem('theme-preference');
            
            console.log('System theme changed to:', currentTheme); // For debugging
        });
        
        // Category info tooltip functionality
        const categoryInfo = document.getElementById("categoryInfo");
        const categoryTooltip = document.getElementById("categoryTooltip");
        let tooltipVisible = false;
        
        categoryInfo.addEventListener("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            if (tooltipVisible) {
                hideTooltip();
            } else {
                showCategoryTooltip(e);
            }
        });
        
        function showCategoryTooltip(e) {
            const categories = [...new Set(tutorials.map(t => t.category))].sort();
            let tooltipContent = "";
            
            categories.forEach(cat => {
                const info = categoryDescriptions[cat];
                if (info) {
                    tooltipContent += `
                    <h4>${info.title}</h4>
                    <p>${info.description}</p>
                `;
                } else {
                    tooltipContent += `
                    <h4>${cat}</h4>
                    <p>Category description not available.</p>
                `;
                }
            });
            
            categoryTooltip.innerHTML = tooltipContent;
            
            // Position tooltip
            const rect = categoryInfo.getBoundingClientRect();
            const container = document.querySelector('.container');
            const containerRect = container.getBoundingClientRect();
            
            categoryTooltip.style.left = (rect.left - containerRect.left + 20) + "px";
            categoryTooltip.style.top = (rect.bottom - containerRect.top + 5) + "px";
            
            categoryTooltip.classList.add("visible");
            tooltipVisible = true;
        }
        
        function hideTooltip() {
            categoryTooltip.classList.remove("visible");
            tooltipVisible = false;
        }
        
        // Preview functionality
        const previewTooltip = document.getElementById("previewTooltip");
        let previewCache = new Map(); // Cache to avoid re-fetching same content
        let previewTimeout;
        let currentPreviewTarget = null;

        // Fix image paths in HTML content
        function fixImagePaths(htmlContent, filename) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            
            // Find all img tags
            const images = doc.querySelectorAll('img');
            
            images.forEach(img => {
                const src = img.getAttribute('src');
                if (src && src.startsWith('../')) {
                    // Convert relative path to absolute path
                    // If notebook is in htmls/ and uses ../data/images/file.png
                    // We need to resolve this to data/images/file.png
                    const newSrc = src.replace('../', '');
                    img.setAttribute('src', newSrc);
                }
            });
            
            return doc.documentElement.innerHTML;
        }

        // Extract preview content from HTML content
        function extractPreviewContent(htmlContent, filename) {
            // First, fix the image paths
            const fixedHtmlContent = fixImagePaths(htmlContent, filename);
            
            const parser = new DOMParser();
            const doc = parser.parseFromString(fixedHtmlContent, 'text/html');
            
            let previewText = '';
            let previewHTML = '';
            
            // Look for PREVIEW section specifically
            const cells = doc.querySelectorAll('.jp-Cell, .cell, td, div, p');
            
            for (let cell of cells) {
                const text = cell.textContent || cell.innerText || '';
                const lowerText = text.toLowerCase();
                
                // Check for preview section
                if (lowerText.includes('preview')) {
                    // Get the parent element that contains the preview content
                    let previewContainer = cell;
                    
                    // Try to find a more specific container if this is just a header
                    if (text.trim().toLowerCase() === 'preview' || text.trim().toLowerCase().startsWith('preview:')) {
                        // Look for the next sibling or parent that contains actual content
                        previewContainer = cell.nextElementSibling || cell.parentElement;
                    }
                    
                    if (previewContainer) {
                        // Extract both text and HTML
                        previewText = previewContainer.textContent || previewContainer.innerText || '';
                        previewHTML = previewContainer.innerHTML || '';
                        
                        // Clean up text - remove "PREVIEW" word and pilcrow characters
                        previewText = previewText
                            .replace(/preview[:\s]*/gi, '')
                            .replace(/¶/g, '')
                            .trim();
                        
                        // Clean up HTML - remove script tags and other potentially harmful elements
                        previewHTML = previewHTML
                            .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '')
                            .replace(/<link[^>]*>/gi, '')
                            .replace(/preview[:\s]*/gi, '')
                            .replace(/¶/g, '');
                        
                        // Fix image paths in the preview HTML as well
                        const tempDoc = parser.parseFromString(previewHTML, 'text/html');
                        const previewImages = tempDoc.querySelectorAll('img');
                        previewImages.forEach(img => {
                            const src = img.getAttribute('src');
                            if (src && src.startsWith('../')) {
                                const newSrc = src.replace('../', '');
                                img.setAttribute('src', newSrc);
                            }
                        });
                        previewHTML = tempDoc.documentElement.innerHTML;
                        
                        // If we found content, break
                        if (previewText || previewHTML.includes('<img')) {
                            break;
                        }
                    }
                }
            }
            
            return { 
                text: previewText.substring(0, 300), 
                html: previewHTML,
                hasImages: previewHTML.includes('<img')
            };
        }

        // Show preview tooltip
        async function showPreview(element, filename) {
            currentPreviewTarget = element;
            
            // Position tooltip near the element
            const rect = element.getBoundingClientRect();
            const container = document.querySelector('.container');
            const containerRect = container.getBoundingClientRect();
            
            previewTooltip.style.left = (rect.left - containerRect.left) + "px";
            previewTooltip.style.top = (rect.bottom - containerRect.top + 10) + "px";
            
            // Show loading state
            previewTooltip.innerHTML = `
                <div class="preview-title">${element.textContent}</div>
                <div class="loading">Loading preview...</div>
            `;
            previewTooltip.classList.add("visible");
            
            // Check cache first
            if (previewCache.has(filename)) {
                const cached = previewCache.get(filename);
                displayPreview(element.textContent, cached);
                return;
            }
            
            try {
                // Fetch the HTML file
                const response = await fetch(`htmls/${filename}`);
                if (!response.ok) throw new Error('Failed to load');
                
                const htmlContent = await response.text();
                const preview = extractPreviewContent(htmlContent, filename);
                
                // Cache the result
                previewCache.set(filename, preview);
                
                // Only show if we're still hovering the same element
                if (currentPreviewTarget === element) {
                    displayPreview(element.textContent, preview);
                }
                
            } catch (error) {
                if (currentPreviewTarget === element) {
                    previewTooltip.innerHTML = `
                        <div class="preview-title">${element.textContent}</div>
                        <div class="error">Preview not available</div>
                    `;
                }
            }
        }

        function displayPreview(title, content) {
            let html = `<div class="preview-title">${title}</div>`;
            
            if (content.html && content.hasImages) {
                // If there are images, show the full HTML content
                html += `
                    <div class="preview-section">
                        <div class="preview-html">${content.html}</div>
                    </div>
                `;
            } else if (content.text) {
                // If no images, show text content
                html += `
                    <div class="preview-section">
                        <div class="section-content">${content.text}${content.text.length >= 300 ? '...' : ''}</div>
                    </div>
                `;
            } else {
                html += `<div class="error">No preview content found</div>`;
            }
            
            previewTooltip.innerHTML = html;
        }

        function hidePreview() {
            previewTooltip.classList.remove("visible");
            currentPreviewTarget = null;
        }

        // Add event listeners to topic links
        function addPreviewListeners() {
            const topicLinks = document.querySelectorAll('#tutorialTable a');
            
            topicLinks.forEach(link => {
                const filename = link.getAttribute('href').replace('htmls/', '');
                
                link.addEventListener('mouseenter', () => {
                    clearTimeout(previewTimeout);
                    previewTimeout = setTimeout(() => {
                        showPreview(link, filename);
                    }, 500); // 500ms delay before showing preview
                });
                
                link.addEventListener('mouseleave', () => {
                    clearTimeout(previewTimeout);
                    previewTimeout = setTimeout(() => {
                        hidePreview();
                    }, 200); // 200ms delay before hiding
                });
            });
        }

        // Keep preview visible when hovering over it
        previewTooltip.addEventListener('mouseenter', () => {
            clearTimeout(previewTimeout);
        });

        previewTooltip.addEventListener('mouseleave', () => {
            hidePreview();
        });
        document.addEventListener("click", (e) => {
            if (!categoryInfo.contains(e.target) && !categoryTooltip.contains(e.target)) {
                hideTooltip();
            }
        });
        
        fetch('tutorials.csv')
        .then(response => response.text())
        .then(data => {
            const parsed = Papa.parse(data, {
                header: true,
                skipEmptyLines: true
            });
            
            tutorials = parsed.data.map(row => ({
                category: row.category || '',
                topic: row.topic || '',
                tags: row.tags || '',
                filename: row.html || ''
            }));
            
            // Assign colors to categories dynamically
            assignCategoryColors();
            
            // Populate category filter
            const categorySelect = document.getElementById('categoryFilter');
            const categories = [...new Set(tutorials.map(t => t.category))].sort();
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorySelect.appendChild(option);
            });
            
            renderTable();
            
            // Add preview listeners after rendering table
            setTimeout(addPreviewListeners, 100);
        });
        
        function renderTable() {
            const categoryFilter = document.getElementById('categoryFilter').value.toLowerCase();
            const searchQuery = document.getElementById('searchBox').value.toLowerCase();
            const tableBody = document.querySelector('#tutorialTable tbody');
            tableBody.innerHTML = '';
            
            tutorials
            .filter(t =>
                (!categoryFilter || t.category.toLowerCase() === categoryFilter) &&
                (!searchQuery || (t.topic + ' ' + t.tags).toLowerCase().includes(searchQuery))
            )
            .forEach(t => {
                const tr = document.createElement('tr');
                const color = categoryColorMap[t.category] || "#ddd"; // fallback color
                tr.innerHTML = `
                <td class="category" style="color: ${color}; font-weight: bold;">
                    ${t.category}
                </td>
                <td><a href="htmls/${t.filename}" target="_blank">${t.topic}</a></td>
                <td>${t.tags || '-'}</td>
            `;
                tableBody.appendChild(tr);
            });
        }
        
        document.getElementById('categoryFilter').addEventListener('change', () => {
            renderTable();
            setTimeout(addPreviewListeners, 100);
        });
        document.getElementById('searchBox').addEventListener('input', () => {
            renderTable();
            setTimeout(addPreviewListeners, 100);
        });
        
        // Request Topic button dynamic title
        document.getElementById('requestTopicBtn').addEventListener('click', function(e) {
            e.preventDefault();
            const searchValue = document.getElementById('searchBox').value.trim();
            const capitalizedValue = searchValue.charAt(0).toUpperCase() + searchValue.slice(1);
            const baseUrl = "https://github.com/meluron-codecafe/DevQuest/issues/new";
            const params = new URLSearchParams({
                assignees: "ankit0anand0",
                labels: "tutorials",
                projects: "",
                template: "",
                title: searchValue ? `[TUTORIAL REQUEST] ${capitalizedValue}` : "[TUTORIAL REQUEST]"
            });
            window.open(`${baseUrl}?${params.toString()}`, "_blank");
        });
    </script>

</body>
</html>